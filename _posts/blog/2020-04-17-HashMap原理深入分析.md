---
layout:     post
title:      HashMap原理分析
subtitle:   HashMap原理分析
date:       2020-04-17
author:     tang
header-img: img/home-bg-art.jpg
catalog: true
tags:
    - HashMap
    - Java
    
---
* TOC
{:toc}

# 前言

>  在平常的开发过程中，我们会使用到HashMap处理key-value数据结构类型的数据，那么需要深入理解一些HashMap的原理。

- [x] HashMap初始容量，扩容倍数
- [x] HashMap 1.7 Hash碰撞，以及如何解决Hash碰撞
- [x] HashMap1.8 数组 + 链表 + 红黑树
- [x] HashMap常见主要方法执行流程


## 1. Java1.7中的HashMap

#### 1.1 hashMap 数据结构

#### 1.2 hashMap 加载因子、阀值

###### 1.2.1 加载因子为什么是0.75？

###### 1.2.2 为什么数组容量一定是2的指数幂？

#### 1.3 hashMap 链表数据插入方法

#### 1.4 resize扩容机制

#### 1.5 put方法执行流程

#### 1.6 get方法执行流程

#### 1.7 remove 方法执行流程


## 2. Java1.8中的HashMap


#### 2.1 数据结构

#### 2.2 resize扩容机制
> 在java8中Hashmap扩容机制避免了在jdk1.7中需要进行rehash，重新确定在新数组中的位置，1.7的时候进行rehash在高并发的场景下容易造成死循环，死锁。在java8中的Hashmap引入了高位低位指针避免了进行rehash。

###### 2.3 高位指针
> 1. 判断key的hash值与扩容前数组容量进行位运算不为0时表示是高位指针
> 2. 高位指针在新数组中的位置是在就数组中的索引+旧数组容量


###### 2.4 低位指针
> 1. 判断key的hash值与扩容前数组容量进行位运算为0时表示是低位指针
> 2. 低位指针在新数组中的位置和以前在就数组中的索引位置一致

```java
  do {
              next = e.next;
              // 判断key的hash值与扩容前数组容量进行位运算为0时表示是低位指针
              if ((e.hash & oldCap) == 0) {
                if (loTail == null)
                  loHead = e;
                else
                  loTail.next = e;
                loTail = e;
              }
              // 判断key的hash值与扩容前数组容量进行位运算不为0时表示是高位指针
              else {
                if (hiTail == null)
                  hiHead = e;
                else
                  hiTail.next = e;
                hiTail = e;
              }
            } while ((e = next) != null);
            if (loTail != null) {
              loTail.next = null;
              // 低位指针在新数组中的位置和以前在就数组中的索引位置一致
              newTab[j] = loHead;
            }
            if (hiTail != null) {
              hiTail.next = null;
              // 高位指针在新数组中的位置是在就数组中的索引+旧数组容量
              newTab[j + oldCap] = hiHead;
            }
          }
```


#### 2.3 put方法执行流程



#### 2.4 get方法执行流程

#### 2.5 remove 方法执行流程

## 3 HashMap1.8对比HashMap1.7在那些方面有提升

